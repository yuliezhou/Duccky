<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>重置密码</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">		
	<link href="../../css/publicSty.css" rel="stylesheet"></link>
    <link href="../../plugin/layer/need/layer.css" rel="stylesheet"></link>
    <link href="../../css/center_public.css" rel="stylesheet">
    <link href="../../css/login.css" rel="stylesheet"></link>
    <script src="../../plugin/layer/layer.js"></script>
    <script src="../../plugin/jquery.min.js"></script>
</head>
<body>
	<header>
		<div class="head_topbar active">
            <a href="javascript:history.back()" class="head_left">
                <img src="../../images/pullToLeft.png" alt="" class="back">
            </a>
            <div class="head_title">
                <font>重置密码</font>
            </div>
            <div class="head_right"></div>
        </div>
	</header>
	<div class="step1">
		<div class="phone">
			<img src="../../images/login_tel.png">
			<input type="text" placeholder="请输入已绑定的手机号" id="phone" onkeyup="value=value.replace(/[^\d]/g,'')">
		</div>
		<div class="yz">
			<img src="../../images/login_yz.png">
			<input type="number" placeholder="请输入验证码" id="yz">
			<div class="yz_box">
				<div class="yz_send yz_send_able" id="yz_send">发送验证码</div>
			</div>
		</div>
		<div class="yz">
			<img src="../../images/login_pwd.png">
			<input type="password" placeholder="设置新密码" id="newPwd">
		</div>
		<div class="box">
			<input type="button" value="完成" class="queding" id="StepEnd">
		</div>
	</div>
</body>
</html>
<script src="../../src/js/reviewPwd.js"></script>
<script type="text/javascript">
	$(function() {
		var layerCommon = function(content) {
		    layer.open({
		        content: content,
		        skin: 'msg',
		        time: 1.5
		    });
		}

		var numberTel = function(num){
			if(num == ""){
				layerCommon("请输入手机号");
				return true;
			}else if (!(/^1[3|4|5|7|8]\d{9}$/.test(num))) {
			    layerCommon('手机号不符合规范');
			    return true;
			}
		}

		var numberCode = function(num){
			if(num == ""){
				layerCommon("请输入验证码");
				$("#yz").focus();
				return true;
			}else if (!(/^\d{6}$/.test(num))) {
			    layerCommon('验证码不符合规范');
			    $("#yz").focus();
			    return true;
			}
		}

		var strPwd = function(str){
			if(str == ""){
				layerCommon("请输入密码");
				$("#pwd").focus();
				return true;
			}else if(str.length<6){
				layerCommon("密码不少于6位");
				$("#pwd").focus();
				return true;
			}
		}

		$("#yz_send").click(function() {
			var url = "http://192.168.1.105/";
			var getYzAddr = "User/Login/sendSms";//发送短信
	        var phone = $('#phone').val();
		        $.ajax({
		        	type: 'get',
		        	url: url+getYzAddr,
		        	dataType: 'json',
		        	data: {phone: $("#phone").val(),isajax:1},
		        	success: function(data) {
		        		 if(data.status){
		        			$('#yz_send').addClass("back_ac")
				            $('#yz_send').html('重新发送&nbsp;60&nbsp;(s)');
				            var num = 60;
				            var timer = null;
				            timer = setInterval(function() {
				                num -= 1;
				                if (num > 0) {
				                    $('#yz_send').html("重新发送&nbsp;" + num + "&nbsp;(s)");
				                    $('#yz_send').addClass("back_ac")
				                } else {
				                    clearInterval(timer);
				                    $('#yz_send').html("发送验证码");
				                    $('#yz_send').removeClass("back_ac")
				                }
				            }, 1000);
		        		 }else{
		        		 	layerCommon(data.msg);
		        		 }
		        	}, 
					error:function(){ 
						layerCommon(data.msg);
					    //请求出错处理 
					} 
		        });
	    });
	    $("#StepEnd").click(function(event) {
	    	var phone = $("#phone").val();
			var newPwd = $("#newPwd").val();
			var yz = $("#yz").val();
			if(numberTel(phone)||strPwd(newPwd)||numberCode(yz))return;
			var url = "http://192.168.1.105/";
			var reviewPwdAddr = "User/Password/setNewPwdByPhone";//重置密码·
	        var phone = $('#phone').val();
		        $.ajax({
		        	type: 'post',
		        	url: url+reviewPwdAddr,
		        	dataType: 'json',
		        	data: {phone: phone,password:newPwd,code:yz},
		        	success: function(data) {
		        		 if(data.status){
		        			layerCommon(data.msg);
		        		 }else{
		        		 	layerCommon(data.msg);
		        		 }
		        	}, 
					error:function(){ 
						layerCommon(data.msg);
					    //请求出错处理 
					} 
		        });
	    });

	    CountdownSetInter = self.setInterval("login_yz_send()", 500);
	    login_yz_send = function() {
	        var phone = $('#phone').val();
	        if ((/^1[3|4|5|7|8]\d{9}$/.test(phone))) {
	            $("#yz_send").addClass("yz_send_able");
	        } else {
	            $("#yz_send").removeClass("yz_send_able");
	        }
	    };
	});
</script>

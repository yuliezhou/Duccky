<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>搜索</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="css/bootstrap.css">		
	<link rel="stylesheet" href="css/search-f.css">
	<link rel="stylesheet" href="http://img1.myzx.cn/css/mobile/css/swiper.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 添加弹出的搜索页 -->
    <div class="none2" id="none2">
		<div class="none_header">
			<div class="none2_search">
			<!--onkeydown="if(event.keyCode==13 && !getElementById('search_input').value){return false;}"-->
				<form action="search-jieguo-f.html" method="get" >
					<input placeholder="中暑了怎么办" name="kw" id="search_input">
				</form>
				<img src="images/iocn4.png" alt="">
				<span><a href="javascript:history.back()">取消</a></span>
			</div>
			<div class="search_his">
				<div class="search_histit">
					<span>搜索历史</span>
					<span id="clear">清除</span>
				</div>
				<div class="search_hiscont" id="search_hiscont">
					<div class="morehist" id="morehist">
						<span>查看更多历史记录</span>&nbsp;&nbsp;
						<img src="images/xia.png" alt="">
					</div>
				</div>
			</div>
		</div>
		<div class="hot_search">
			<div class="hot_searchtit">
				<span>热门搜索</span>
			</div>
			<ul>
				<li><a href="search-jieguo-f.html?kw=子宫肌瘤">子宫肌瘤</a></li>
				<li><a href="search-jieguo-f.html?kw=子宫肌瘤">子宫肌瘤</a></li>
				<li><a href="search-jieguo-f.html?kw=儿童生长发育异常">儿童生长发育异常</a></li>
				<li><a href="search-jieguo-f.html?kw=偏头痛">偏头痛</a></li>
				<li><a href="search-jieguo-f.html?kw=偏头痛">偏头痛</a></li>
				<li><a href="search-jieguo-f.html?kw=两性健康">两性健康</a></li>
				<li><a href="search-jieguo-f.html?kw=两性健康">两性健康</a></li>
			</ul>
		</div>
		<div class="empty_gray"></div>
	</div>
<!-- 添加弹出的搜索页 -->
	<script src="http://img1.myzx.cn/js/mobile/js/font.js"></script>
	<script src="http://img1.myzx.cn/js/mobile/js/jquery-3.2.0.min.js"></script>
	<script type="text/javascript" src="layer.mobile-v2.0/layer.mobile-v2.0/layer_mobile/layer.js"></script>
	<script type="text/javascript" src="js/bootstrap.js"></script>
	<script src="http://img1.myzx.cn/js/mobile/js/swiper-3.4.2.min.js"></script>
</body>
</html>
<script type="text/javascript">
$(function(){
	var history = getCookie('search_history');
	
	if(history) {
		var arr = history.split('|');
		
		var html_his = '';
		for(var i=0; i<arr.length; i++) {
			var c=arr[i];
			for(var m=i+1;m<arr.length;m++){
				if(arr[m]==c){
					arr.splice(m,1);
					m--;
				}
			}
			html_his+='<div class="search_hislist">'+
					  '<span>'+arr[i]+'</span>'+
					  '<img src="images/cha.png" alt="" class="img_del"></div>';		
		}	
		$("#search_hiscont").prepend(html_his);
		$(".search_hislist").eq(4).addClass("his_ac")
		$(".search_hislist").eq(5).addClass("his_ac")
	}
	var num=$("#search_hiscont").find(".search_hislist").length;
	console.log(num)
	if(num<5){
		$("#morehist").hide()
	}
	if(num=0){
		delCookie("search_history");
	}
	//删除历史记录行
	$("#search_hiscont .img_del").on("click",function(){
		num--;
		if(num<5){
			$("#morehist").hide()
		}
		$(this).parents(".search_hislist").fadeOut("200");
		var idx = $(this).parent(".search_hislist").index();
		var search_history =  getCookie('search_history') ? getCookie('search_history'): '';
		if (search_history) {
			var arr = search_history.split('|');
			arr.splice(idx,1);
			//arr.sort
			console.log(arr);
			search_history = arr.join('|');
			setCookie('search_history', search_history);
		} 
	})
	$("#clear").click(function(){
		$(".search_hislist").fadeOut("200");
		$("#morehist").fadeOut("200");
		delCookie("search_history");
	})
	//历史记录显示隐藏
	$("#morehist").click(function(){
		$(".search_hislist").eq(4).toggleClass("his_ac");
		$(".search_hislist").eq(5).toggleClass("his_ac");
	})

	//获取cookie
	function getCookie(name)
	{
		var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
		if(arr=document.cookie.match(reg))
		return unescape(arr[2]);
		else
		return null;
	}
	//设置cookie
	function setCookie(name,value)
	{
		var Days = 30;
		var exp = new Date();
		exp.setTime(exp.getTime() + Days*24*60*60*1000);
		document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
	}
	//删除cookie
	function delCookie(name)
	{
		var exp = new Date();
		exp.setTime(exp.getTime() - 1);
		var cval=getCookie(name);
		if(cval!=null)
		document.cookie= name + "="+cval+";expires="+exp.toGMTString();
	}

	$('.none2_search form').on('submit', function() {
		var kw = $(this).children('input').val();
		if (!kw) return false;
		var search_history =  getCookie('search_history') ? getCookie('search_history'): '';
		
		if (!search_history) {
			search_history = kw;
		} else {
			var arr = search_history.split('|');
			if(arr.length>=6){
				arr.shift();
				arr.sort();
			}
			arr.push(kw);
			search_history = arr.join('|');
		}		
		setCookie('search_history', search_history);
	})
})	
</script>
